<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ì¸ ë…¸ë˜ë°© ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        :root { --primary: #1a73e8; --bg: #f8f9fa; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h1 { text-align: center; color: var(--primary); }
        h2 { border-bottom: 2px solid var(--primary); padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        button { padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; transition: 0.2s; }
        button:hover { background: #1557b0; }
        .song-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #eee; }
        .song-item:last-child { border-bottom: none; }
        .badge { background: #e8f0fe; color: var(--primary); padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ ìŠˆí¼ ì½”ì¸ ë…¸ë˜ë°© ì„œë¹„ìŠ¤</h1>

        <div class="card">
            <h2>ğŸ” ë¹ ë¥¸ ì˜ˆì•½</h2>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="songIdInput" placeholder="ê³¡ ID ì…ë ¥ (ì˜ˆ: 1)" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                <button onclick="enqueueSong()">ì˜ˆì•½í•˜ê¸°</button>
                <button onclick="enqueueSong(true)" style="background: #dc3545;">ìš°ì„ ì˜ˆì•½</button>
            </div>
        </div>

        <div class="card">
            <h2>ğŸ”¥ ì‹¤ì‹œê°„ ì¸ê¸° ì°¨íŠ¸ <button onclick="getPopular()">ğŸ”„</button></h2>
            <div id="popular-list">ì°¨íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>

        <div class="card">
            <h2>â³ í˜„ì¬ ëŒ€ê¸°ì—´ <button onclick="getQueue()">ğŸ”„</button></h2>
            <div id="queue-list">ëŒ€ê¸°ì—´ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</div>
        </div>
    </div>

    <script>
        const API_BASE = "http://127.0.0.1:8000/api/songs";

        // 1. ì¸ê¸° ì°¨íŠ¸ ê°€ì ¸ì˜¤ê¸°
        async function getPopular() {
            try {
                const res = await fetch(`${API_BASE}/charts/popular`);
                const data = await res.json();
                const listDiv = document.getElementById('popular-list');
                listDiv.innerHTML = data.map(s => `
                    <div class="song-item">
                        <span><strong>${s.title}</strong> - ${s.artist}</span>
                        <span class="badge">ğŸ”¥ ${s.reserve_count}íšŒ ì˜ˆì•½ë¨</span>
                    </div>
                `).join('') || "ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.";
            } catch (e) { console.error("ì°¨íŠ¸ ë¡œë”© ì‹¤íŒ¨", e); }
        }

        // 2. ëŒ€ê¸°ì—´ ê°€ì ¸ì˜¤ê¸°
        async function getQueue() {
            try {
                const res = await fetch(`${API_BASE}/queue/list`);
                const data = await res.json();
                const listDiv = document.getElementById('queue-list');
                listDiv.innerHTML = data.map(q => `
                    <div class="song-item">
                        <span><b style="color:var(--primary)">${q.position}ìœ„</b> ${q.title} - ${q.artist}</span>
                        <button onclick="cancelQueue(${q.id})" style="background:#bbb; font-size:12px;">ì·¨ì†Œ</button>
                    </div>
                `).join('') || "í˜„ì¬ ëŒ€ê¸° ì¤‘ì¸ ê³¡ì´ ì—†ìŠµë‹ˆë‹¤.";
            } catch (e) { console.error("ëŒ€ê¸°ì—´ ë¡œë”© ì‹¤íŒ¨", e); }
        }

        // 3. ê³¡ ì˜ˆì•½í•˜ê¸°
        async function enqueueSong(isPriority = false) {
            const songId = document.getElementById('songIdInput').value;
            if(!songId) return alert("ê³¡ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            try {
                const res = await fetch(`${API_BASE}/${songId}/enqueue?is_priority=${isPriority}`, {
                    method: 'POST'
                });
                const data = await res.json();
                alert(data.message);
                getQueue(); // ì˜ˆì•½ í›„ ëŒ€ê¸°ì—´ ê°±ì‹ 
                getPopular(); // ì¸ê¸° ì°¨íŠ¸ë„ ê°±ì‹ ë  ìˆ˜ ìˆìŒ
            } catch (e) { alert("ì˜ˆì•½ ì‹¤íŒ¨! ì„œë²„ë¥¼ í™•ì¸í•˜ì„¸ìš”."); }
        }

        // 4. ì˜ˆì•½ ì·¨ì†Œí•˜ê¸°
        async function cancelQueue(queueId) {
            if(!confirm("ì •ë§ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            await fetch(`${API_BASE}/queue/${queueId}`, { method: 'DELETE' });
            getQueue();
        }

        // ì´ˆê¸° ë°ì´í„° ë¡œë”©
        getPopular();
        getQueue();
    </script>
</body>
</html>